---
import Layout from "../layouts/Layout.astro";
import { ui } from "../i18n/ui.js";

/** Return locale from cookie header string (defaults to empty string to avoid implicit any) */
function getLocaleFromCookie(cookieHeader = '') {
	if (!cookieHeader) return "en";
	const match = cookieHeader.match(/(?:^|; )locale=([^;]+)/);
	return match ? match[1] : "en";
}

const locale =
	getLocaleFromCookie(Astro.request.headers.get("cookie") ?? '') === "fr"
		? "fr"
		: "en";
---

<Layout>
	<div class="min-h-screen bg-white">
		<div class="container mx-auto px-4 py-8 max-w-6xl">
			<!-- En-tête -->
			<div class="text-center mb-8">
				<h1 class="text-4xl font-bold mb-4 text-black">Générateur de Lunettes par IA</h1>
				<p class="text-lg text-gray-600">Décrivez vos lunettes idéales et laissez l'IA les créer pour vous</p>
			</div>

			<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
				<!-- Colonne gauche : Formulaire -->
				<div class="card bg-gray-100 shadow-xl">
					<div class="card-body">
						<h2 class="card-title text-2xl mb-4 text-black">Décrivez vos lunettes</h2>
						
						<!-- Champ de description -->
						<div class="form-control mb-4">
							<label class="label">
								<span class="label-text font-semibold text-black">Description détaillée</span>
							</label>
							<textarea 
								id="prompt-input" 
								class="textarea textarea-bordered h-32 resize-none bg-white text-black border-gray-300" 
								placeholder="Ex: Des lunettes aviateur modernes avec une monture dorée et des verres polarisés bleu clair..."
							></textarea>
							<label class="label">
								<span class="label-text-alt text-gray-600">Soyez précis : forme, couleurs, matériaux, style...</span>
							</label>
						</div>

						<!-- Suggestions rapides -->
						<div class="mb-4">
							<label class="label">
								<span class="label-text font-semibold text-black">Suggestions rapides</span>
							</label>
							<div class="flex flex-wrap gap-2">
								<button class="btn btn-sm bg-gray-800 text-white hover:bg-gray-900 border-0 suggestion-btn" data-suggestion="Des lunettes aviateur classiques avec une monture métallique argentée et des verres gris fumés">
									Aviateur classique
								</button>
								<button class="btn btn-sm bg-gray-800 text-white hover:bg-gray-900 border-0 suggestion-btn" data-suggestion="Des lunettes rondes style vintage avec une monture en écaille de tortue et des verres transparents">
									Rondes vintage
								</button>
								<button class="btn btn-sm bg-gray-800 text-white hover:bg-gray-900 border-0 suggestion-btn" data-suggestion="Des lunettes de soleil cat-eye modernes avec une monture noire et des verres dégradés roses">
									Cat-eye moderne
								</button>
								<button class="btn btn-sm bg-gray-800 text-white hover:bg-gray-900 border-0 suggestion-btn" data-suggestion="Des lunettes rectangulaires minimalistes avec une monture fine en titane gris et des verres anti-lumière bleue">
									Rectangulaire minimaliste
								</button>
							</div>
						</div>

						<!-- Boutons d'action -->
						<div class="card-actions justify-end mt-4">
							<button id="generate-btn" class="btn bg-primary hover:bg-blue-500 text-white border-0 btn-block">
								<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
								</svg>
								Générer avec l'IA
							</button>
						</div>					<!-- État de chargement -->
					<div id="loading-state" class="hidden mt-4">
						<div class="alert bg-gray-200 border-gray-300">
							<span class="loading loading-spinner loading-md"></span>
							<span class="text-black">L'IA génère vos lunette... Patientez quelques secondes.</span>
						</div>
					</div>

					<!-- Messages d'erreur -->
					<div id="error-state" class="hidden mt-4">
						<div class="alert alert-error">
							<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
							<span id="error-message" class="text-white">Une erreur s'est produite</span>
						</div>
					</div>
				</div>
			</div>

			<!-- Colonne droite : Aperçu et résultats -->
			<div class="card bg-gray-100 shadow-xl">
				<div class="card-body">
					<h2 class="card-title text-2xl mb-4 text-black">Aperçu</h2>
					
					<!-- Zone d'affichage du SVG -->
					<div id="svg-preview" class="bg-white rounded-lg p-8 min-h-[400px] flex items-center justify-center border-2 border-dashed border-gray-300">
						<div class="text-center text-gray-400">
							<svg class="w-24 h-24 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
							</svg>
							<p class="text-lg text-gray-400">Vos lunettes apparaîtront ici</p>
						</div>
					</div>

					<!-- Code SVG (caché par défaut) -->
					<div id="svg-code-container" class="hidden mt-4">
						<label class="label">
							<span class="label-text font-semibold text-black">Code SVG généré</span>
						</label>
						<textarea id="svg-code" class="textarea textarea-bordered font-mono text-sm h-32 resize-none bg-white text-black border-gray-300" readonly></textarea>
					</div>

					<!-- Boutons d'action sur le SVG -->
					<div id="svg-actions" class="hidden mt-4 gap-2">
						<button id="save-btn" class="btn btn-success flex-1 text-white">
							<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
							</svg>
							Sauvegarder dans ma collection
						</button>
						<button id="toggle-code-btn" class="btn btn-outline border-gray-300 text-black hover:bg-gray-200">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
							</svg>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</Layout>

<script src="/src/scripts/generator.js"></script>